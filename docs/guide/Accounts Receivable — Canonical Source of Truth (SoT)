# Accounts Receivable (AR) â€” Source of Truth (SoT)

Status: LOCKED
Owner: POS Platform
Last Reviewed: 2026-02-18
Supersedes: legacy status-based AR listing rules

## Scope

Defines canonical rules for:

- AR list eligibility
- customer ledger balances
- relationship between CSS decisions and AR
- separation of customer AR vs rider/cashier variance workflows

## Non-Negotiable AR Authority

1. AR balance comes from `customerAr` entries only.
2. `customerAr` is created only from manager-approved CSS decisions where `arBalance > 0`.
3. `Order.status` (`UNPAID`, `PARTIALLY_PAID`) is operational only; not AR authority.
4. `isOnCredit` is operational/display only; not AR authority.

## Commercial Decision Mapping

For a receipt with `remaining = frozenTotal - cashCollected`:

1. `APPROVE_OPEN_BALANCE` -> `arBalance = remaining` -> create/update `customerAr`.
2. `APPROVE_HYBRID` -> `arBalance = remaining - approvedDiscount` -> create/update `customerAr` for AR part.
3. `APPROVE_DISCOUNT_OVERRIDE` -> `arBalance = 0` -> no AR entry.
4. `REJECT` -> no AR entry unless customer later pays/settles under accepted rule.

## AR Index Eligibility Rule

A customer appears in AR list only when:

- customer has at least one `customerAr` row with open `balance > 0`.

Not valid as inclusion criteria by themselves:

- open order status
- partial payment state
- run still in turnover processing

## Customer Ledger Rule

Customer ledger debit/credit must be decision-traceable:

1. Debits: from approved `customerAr` principal/balance states.
2. Credits: payments applied to `customerAr` balances.
3. Rider shortage bridge lines are rider-accountability artifacts and must not create new customer AR principal.

## Data Source Matrix

1. AR Principal SoT: `customerAr.principal`, `customerAr.balance`, `customerAr.status`.
2. Decision Trace SoT: `clearanceDecision` linked to `customerAr.clearanceDecisionId`.
3. Frozen commercial basis SoT: `OrderItem.lineTotal` and `RunReceiptLine.lineTotal`.

## Explicit Anti-Rules

1. Do not compute AR as `order total - payments` for list eligibility.
2. Do not rely on `PARTIALLY_PAID` to classify AR.
3. Do not create customer AR from cashier turnover shortage alone.
4. Do not infer discount/AR without manager CSS decision.

## Operational Notes

1. A customer may have multiple approved utang events across weeks.
2. Each approved event appends to the same customer ledger via new/updated `customerAr` records.
3. Ledger continuity is per customer, decision-driven, and auditable.
